import yaml
import pandas as pd
from snakemake.utils import min_version

min_version("6.0")
shell.prefix("set -euo pipefail; ")


with open(config["align_asm_to_ref"]["config"], "r") as file:
    config["align_asm_to_ref"]["config"] = yaml.safe_load(file)


include: "rules/common.smk"


# Globals shared throughout workflow.
SAMPLES_DF = load_samples_df()
REF_NAME = get_ref_name()
SAMPLE_NAMES = pd.Index(sm_hap.split("_")[0] for sm_hap in SAMPLES_DF.index)


include: "rules/concat_asm.smk"
include: "rules/align_asm_to_ref.smk"
include: "rules/mask_hor_arrays.smk"
include: "rules/ident_cen_ctgs.smk"
include: "rules/dna_brnn.smk"


rule all:
    input:
        rules.mask_hor_arrays_all.input,
        rules.ref_align_all.input,
        rules.concat_asm_all.input,
        rules.ident_cen_ctgs_all.input,
        rules.dna_brnn_all.input,
